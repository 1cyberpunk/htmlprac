<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>ES-Jam „Äú„Çµ„Ç§„Éê„Éº„Éë„É≥„ÇØÈÅìÂ†¥„Äú</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <!-- „Çµ„Ç§„Éê„Éº„Éë„É≥„ÇØÈ¢®„Éï„Ç©„É≥„ÉàÔºàÂ§ñÈÉ®Ôºâ -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root{
            --bg1: #04040a;
            --bg2: #060026;
            --neon-cyan: #00ffe1;
            --neon-mag: #ff2dff;
            --neon-yellow: #ffd400;
            --glass: rgba(255,255,255,0.03);
        }
        html,body{height:100%;margin:0;font-family: "Orbitron",monospace, monospace;background: radial-gradient(1200px 600px at 10% 10%, rgba(0,255,225,0.03), transparent), linear-gradient(120deg, var(--bg2) 0%, #000 60%); color:#e6f7ff;}
        /* Header */
        header{
            display:flex;
            align-items:center;
            justify-content:space-between;
            padding:16px;
            gap:12px;
            backdrop-filter: blur(6px);
            background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border-bottom: 1px solid rgba(255,255,255,0.04);
        }
        header h1{margin:0;font-size:1.4rem; letter-spacing:1px; color:var(--neon-cyan); text-shadow:0 0 16px rgba(0,255,225,0.12);}
        header h1 span{font-size:0.6rem;color:var(--neon-mag);display:inline-block;margin-left:10px}
        .controls{display:flex;gap:8px;align-items:center;}
        button{
            background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
            border:1px solid rgba(255,255,255,0.06);
            color:var(--neon-cyan);
            padding:8px 12px;
            border-radius:6px;
            cursor:pointer;
            font-size:1rem;
            box-shadow:0 6px 18px rgba(0,0,0,0.6), 0 0 12px rgba(0,255,225,0.04);
        }
        button .minor{display:block;font-size:0.6rem;color:#8ff;}
        /* Layout */
        .main{height:calc(100vh - 130px); display:flex; gap:8px; padding:12px;}
        #elmEditor{width:50%; height:100%; border-radius:8px; overflow:hidden; box-shadow: inset 0 0 60px rgba(0,0,0,0.8); border:1px solid rgba(255,255,255,0.03);}
        #elmPreview{width:50%; height:100%; border-radius:8px; border:1px solid rgba(255,255,255,0.03); background: #020014; box-shadow:0 8px 40px rgba(0,0,0,0.7);}
        /* footer */
        footer{padding:12px 20px; text-align:right; color:rgba(200,255,255,0.6); font-size:0.9rem;}
        footer a{color:var(--neon-mag); text-decoration:none;}
        /* Neon labels */
        .label-neon{font-weight:700; color:var(--neon-cyan); text-shadow:0 0 8px rgba(0,255,225,0.12);}
        /* responsive */
        @media (max-width:900px){
            .main{flex-direction:column;}
            #elmEditor,#elmPreview{width:100%; height:50%;}
        }
    </style>
</head>

<body>
    <header>
        <h1>ES-Jam <span>„ÄúCyber Dojo„Äú</span></h1>
        <div class="controls">
            <button id="btnrun"><span class="label-neon">Ëµ∑Âãï</span><span class="minor">NEO-RUN (Ctrl+S)</span></button>
            <button id="btnsave"><span class="label-neon">„É≠„Ç∞„Çí‰øùÂ≠ò</span><span class="minor">EXPORT CORE</span><a id="elmSave"></a></button>
            <button id="btnload"><span class="label-neon">„É≠„Ç∞Ë™≠Ëæº</span><span class="minor">IMPORT</span><input id="elmLoad" type="file" hidden></button>
            <button id="btnshare" title="„Ç∑„Çß„Ç¢" style="font-size:1.05em;">üîó „Ç∑„Çß„Ç¢</button>
        </div>
    </header>

    <div class="main">
        <div id="elmEditor"></div>
        <div>
            <iframe id="elmPreview" src="data:text/html;charset=utf-8;base64,PCFkb2N0eXBlIGh0bWw+PGh0bWw+PGhlYWQ+PG1ldGEgY2hhcnNldD0idXRmLTgiPjx0aXRsZT5FUy1KQU08L3RpdGxlPjxzdHlsZT5ib2R5e21hcmdpbjowO2JhY2tncm91bmQ6IzAwMTtkbGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2hlaWdodDowMTAwaHg7Y29sb3I6I2BmZmY7Zm9udC1mYW1pbHk6bW9ub3NwYWNlfWh9IGgxeyBmb250LXNpemU6Mi4wZW07dGV4dC1zaGFkb3c6MCAwIDggI2BmZmYsMCAwIDI0cHggI2YwZjtjb2xvcjojMGZmZjt9IHAgeyBvcGFjaXR5OjAuO30gc3R5bGU9IiI+PC9zdHlsZT48L2hlYWQ+PGJvZHk+PGRpdj48aDE+RVMtSkFNIC0gQ3liZXIgRG9qbyA8L2gxPjxwPuOBmuOBq-OBmeOBq-OBvOOBk-OBj+OBruOBq-OBueOBj-OCk-OBq-OBq-OBvOOBj+ODvOOCi+OCi-OCk+ODvOOCk-ODvA=="></iframe>
        </div>
    </div>

    <footer>
        <div>v20220821 ‚Äî Neon build by <a href="https://github.com/code4fukui/htmlprac" target="_blank">Code for FUKUI</a></div>
    </footer>

    <script type="module">
        import { monaco } from "https://code4fukui.github.io/monaco-editor/monaco.js";
        import { fixMyHTML } from "https://code4fukui.github.io/fixMyHTML/fixMyHTML.js";

        let g_editor;

        async function „Ç®„Éá„Ç£„Çø„Çí‰Ωú„Çã() {
            g_editor = monaco.editor.create(elmEditor, {
                language: "html",
                autoIndent: "none",
                tabSize: 2,
                minimap: { enabled: false },
                automaticLayout: true,
                theme: "vs-dark",
            });

            let prg = "";
            const url = (new URL(document.location.href)).searchParams.get("url");
            if (url) {
                prg += await (await fetch(url)).text();
                prg += "\n";
            }
            prg += decodeURIComponent(location.hash.substr(1)).replaceAll('scr.ES-Jam.ipt','script');
            g_editor.setValue(prg);

            elmEditor.addEventListener("keyup", (e) => {
                if (e.ctrlKey && e.key == "s") {
                    Ë¶ã„Å¶„Åø„Çã();
                }
            });
        }

        function Ë¶ã„Å¶„Åø„Çã() {
            const p1 = g_editor.getValue();
            const p2 = fixMyHTML(p1);
            if (p1 != p2) {
                g_editor.setValue(p2);
            }
            // „Éó„É¨„Éì„É•„Éº„ÅØ blob „Å´ÊµÅ„ÅóËæº„Çì„ÅßÂç≥Â∫ß„Å´Ë°®Á§∫ÔºàÁèæÂÆü„ÅØÂ£ä„Çå„ÇÑ„Åô„ÅÑÔºâ
            elmPreview.src = URL.createObjectURL(new Blob([g_editor.getValue()], { type: "text/html" }));
        }

        function SAVE„Åô„Çã() {
            // „Çµ„Ç§„Éê„Éº„Éë„É≥„ÇØÈ¢®„ÅÆ„Éï„Ç°„Ç§„É´Âêç
            elmSave.download = `core_dump.${Date.now()}.html`;
            elmSave.href = URL.createObjectURL(new Blob([g_editor.getValue()], { type: "application/octet-stream" }));
            elmSave.click();
        }

        function LOAD„Åô„Çã() {
            const f = new FileReader();
            f.onload = () => {
                g_editor.setValue(f.result);
            };
            f.readAsText(elmLoad.files[0]);
        }

        function „Ç∑„Çß„Ç¢„Åô„Çã() {
            const code = encodeURIComponent(g_editor.getValue().replaceAll('script','scr.ES-Jam.ipt')).replaceAll('(','%28').replaceAll(')','%29').replaceAll("'",'%27');
            navigator.clipboard.writeText(`${location.origin}${location.pathname}#${code}`);
            alert('„Ç∑„Çß„Ç¢„É™„É≥„ÇØ„Çí„ÇØ„É≠„Éº„Éã„É≥„Ç∞„Åó„Åæ„Åó„Åü ‚Äî „ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´Ëª¢ÂÜôÊ∏à„Åø');
        }

        // init
        btnrun.onclick = () => Ë¶ã„Å¶„Åø„Çã();
        elmLoad.onchange = () => LOAD„Åô„Çã();
        btnload.onclick = () => elmLoad.click();
        btnsave.onclick = () => SAVE„Åô„Çã();
        btnshare.onclick = () => „Ç∑„Çß„Ç¢„Åô„Çã();
        „Ç®„Éá„Ç£„Çø„Çí‰Ωú„Çã();
    </script>
</body>

</html>
